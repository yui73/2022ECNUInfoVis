<!DOCTYPE html> 
<html style='height: 100%'>    
<head>        
    <meta charset='utf-8'>  
    <link rel="stylesheet" href="../static/leaflet/leaflet.css"
    integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
    crossorigin=""/>
</head>    
<body style='height: 100%; margin: 0'>        
    <div id="map" style='height: 100%'></div>
    <!-- <div id='container' style='height: 100%'></div>         -->
    <script type='text/javascript' src='../static/js/echarts.min.js'></script>        
    <!-- <script type='text/javascript' src='../static/js/echarts-gl.min.js'></script>         -->
    <script type='text/javascript' src='../static/js/ecStat.min.js'></script>        
    <script type='text/javascript' src='../static/js/dataTool.min.js'></script> 
    <script src="../static/leaflet/leaflet.js"
    integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
    crossorigin=""></script>
    <script src="../static/leaflet/plugins/leaflet.canvas-markers.js"></script>
    <script type="text/javascript" src="http://api.tianditu.gov.cn/api?v=4.0&tk=xx"></script>
    <!-- 载入D3库 -->
    <script src="../static/js/d3.v3.min.js"></script>
    <script type="text/javascript">
        d3.json("../5/data/05-Covid-SH.json",function(data){
            console.log(data);
             // var map = L.map('map').setView([51.505, -0.09], 1);
    // var map = L.map('map').setView([121.47,31.22 ], 8);[22.27231859990752,113.56710553339326],[31.22,121.47]
    var map = L.map('map',{ crs: L.CRS.EPSG4326,}).setView([31.22950,121.39890],15);

    // openstreetmap 寄了换成天地图 需要个人密钥
    L.tileLayer('http://t1.tianditu.com/vec_c/wmts?layer=vec&style=default&tilematrixset=c&Service=WMTS&Request=GetTile&Version=1.0.0&Format=tiles&TileMatrix={z}&TileCol={x}&TileRow={y}&tk=93724b915d1898d946ca7dc7b765dda5', {

        minZoom:1,
        maxZoom: 19,
        maximumLevel: 18, // 必须加上最大级数
        zoomOffset: 1,
        preferCanvas: true,
        attribution: '&copy; <a href="http://t0.tianditu.gov.cn/img_c/wmts?request=GetCapabilities&service=wmts">tianditu</a>'
    }).addTo(map);


    // 创建图层，添加到 map
    var ciLayer = L.canvasIconLayer({preferCanvas: true,}).addTo(map);

    // 创建marker图标，图标属性必须要有以下属性
    // var icon =  L.icon({
    //     // iconUrl: iconUrl,
    //     // iconSize: [circleSize * 2, circleSize * 2],
    //     iconAnchor: [0, 0],
    //     popupAnchor: [0, 0]
    // })
    const iconRetinaUrl = '../static/leaflet/images/marker-icon-2x.png';
    const iconUrl = '../static/leaflet/images/marker-icon.png';
    const shadowUrl = '../static/leaflet/images/marker-shadow.png';
    const iconDefault = L.icon({
    iconRetinaUrl,
    iconUrl,
    shadowUrl,
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    tooltipAnchor: [16, -28],
    shadowSize: [41, 41]
    });

     // 定义 Marker
    var marker =  L.marker([31.22950,121.39890]).bindPopup('TEST').openPopup();
    console.log(marker);
    // 把 Marker 添加到图层
    ciLayer.addMarker(marker);

    // for(let i=0;i<100;i++){
    //     // 定义 Marker
    //     var marker =  L.marker([data[i].lat,data[i].lng], {icon: icon});
    //     // 把 Marker 添加到图层
    //     ciLayer.addMarker(marker);
    // };

 



// // 1万个数据需要优化 要加新插件
//     for(let i=0;i<100;i++){
//         L.marker([data[i].lat,data[i].lng]).addTo(map)
//         .bindPopup()
//         .openPopup();
//     };
    // data.map((item)=>{
    //     L.marker([item.lat,item.lng]).addTo(map)
    // .bindPopup('')
    // .openPopup();
    //     });
    // });

// L.marker([31.22950,121.39890]).addTo(map)
//     .bindPopup('华东师范大学理科大楼')
//     .openPopup();
//         });

});
       </script>
       
   </body>
</html>